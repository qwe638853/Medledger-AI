syntax = "proto3";

package health;

option go_package = "sdk_test/proto;health"; 

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";

service HealthService {
  //å¥æª¢ä¸­å¿ƒä¸Šå‚³å ±å‘Š
  rpc UploadReport(UploadReportRequest) returns (UploadReportResponse){
    option (google.api.http) = {
      post: "/v1/upload"
      body: "*"
    };
  }

  //ç™»å…¥
  rpc Login(LoginRequest) returns (LoginResponse) {
    option (google.api.http) = {
      post: "/v1/login"
      body: "*"
    };
  }

  //ç”¨æˆ¶è¨»å†Š
  rpc RegisterUser(RegisterUserRequest) returns (RegisterResponse) {
    option (google.api.http) = {
      post: "/v1/register/user"
      body: "*"
    };
  }

  //ä¿éšªæ¥­è€…è¨»å†Š
  rpc RegisterInsurer(RegisterInsurerRequest) returns (RegisterResponse) {
    option (google.api.http) = {
      post: "/v1/register/insurer"
      body: "*"
    };
  }

  //ç”¨æˆ¶è®€å–è‡ªå·±çš„å ±å‘Š
  rpc ListMyReports(google.protobuf.Empty) returns (ListMyReportsResponse) {
    option (google.api.http) = {
      get: "/v1/reports"
    };
  }


  //è«‹æ±‚æˆæ¬Š
  rpc RequestAccess(RequestAccessRequest) returns (RequestAccessResponse) {
    option (google.api.http) = {
      post: "/v1/access/request"
      body: "*"
    };
  }

  //è«‹æ±‚æˆæ¬Šåˆ—è¡¨
  rpc ListAccessRequests(google.protobuf.Empty) returns (ListAccessRequestsResponse) {
    option (google.api.http) = {
      get: "/v1/access/requests"
    };
  }

  //æ¥å—æˆæ¬Š
  rpc ApproveAccessRequest(ApproveAccessRequestRequest) returns (ApproveAccessRequestResponse) {
    option (google.api.http) = {
      post: "/v1/access/approve"
      body: "*"
    };
  }


  //æ‹’çµ•æˆæ¬Š
  rpc RejectAccessRequest(RejectAccessRequestRequest) returns (RejectAccessRequestResponse) {
    option (google.api.http) = {
      post: "/v1/access/reject"
      body: "*"
    };
  }


  rpc ListAuthorizedReports(google.protobuf.Empty) returns (ListAuthorizedReportsResponse) {
    option (google.api.http) = {
      get: "/v1/reports/authorized"
    };
  }

  rpc ListReportMetaByPatientID(PatientIDRequest) returns (ListReportMetaResponse) {
    option (google.api.http) = {
      get: "/v1/reports/meta/{patient_id}"
    };
  }

  //ä¿éšªæ¥­è€…è®€æˆæ¬Šå ±å‘Š
  rpc ViewAuthorizedReport(ViewAuthorizedReportRequest) returns (ViewAuthorizedReportResponse) {
    option (google.api.http) = {
      get: "/v1/reports/authorized/{user_id}/{report_id}"
    };
  }

  // ä¿éšªæ¥­è€…æŸ¥çœ‹è‡ªå·±ç™¼å‡ºçš„æˆæ¬Šè«‹æ±‚
  rpc ListMyAccessRequests(google.protobuf.Empty) returns (ListMyAccessRequestsResponse) {
    option (google.api.http) = {
      get: "/v1/access/requests/my"
    };
  }

}



message UploadReportRequest {
  string report_id = 1;
  string user_id = 2;
  string test_results_json = 3;
}


message UploadReportResponse {
    bool success = 1;
    string message = 2;
}


message ReadReportRequest {
  string report_id = 1;
}

message ReadReportResponse {
  bool success = 1;
  string report_content = 2;
}


message LoginRequest {
  string user_id = 1;
  string password = 2;
}

message LoginResponse {
    bool success = 1;
    string message = 2;
    string token = 3; 
}

message RegisterUserRequest {
  string user_id = 1;
  string password = 2;
  string name = 3;
  string date = 4;
  string email = 5;
  string phone = 6;
}

message RegisterInsurerRequest {
  string insurer_id = 1;      // ä¾‹å¦‚: CATHAY-01
  string password = 2;
  string company_name = 3;
  string contact_person = 4;
  string email = 5;
  string phone = 6;
}


message RegisterResponse {
    bool success = 1;
    string message = 2;
    
}

message Report {
  string report_id = 1;
  string clinic_id = 2;
  string patient_hash = 3; 
  string result_json = 4;
  int64 created_at = 5;
}


message ListMyReportsResponse {
  repeated Report reports = 1;
}

// ğŸ”µ ä¿éšªæ¥­è€…é€å‡ºæˆæ¬Šç”³è«‹
message RequestAccessRequest {
  string report_id = 1;
  string patient_id = 2;
  string reason = 3;
  int64 expiry = 4; // Unix ç§’
}

message RequestAccessResponse {
  bool success = 1;
  string message = 2;
}

// ğŸŸ¢ ç—…æ‚£æŸ¥è©¢è‡ªå·±çš„å¾…å¯©ç”³è«‹
message AccessRequest {
  string request_id = 1;
  string report_id = 2;
  string patient_hash = 3;
  string requester_hash = 4;
  string reason = 5;
  int64 requested_at = 6;
  int64 expiry = 7;
  string status = 8;
  string requester_name = 9;
  string company_name = 10;
}

message ListAccessRequestsResponse {
  repeated AccessRequest requests = 1;
}

// ğŸŸ¡ ç—…æ‚£é»åŒæ„æˆæ¬Š
message ApproveAccessRequestRequest {
  string request_id = 1;
}

message ApproveAccessRequestResponse {
  bool success = 1;
  string message = 2;
}

// ğŸ”´ ç—…æ‚£æ‹’çµ•æˆæ¬Š
message RejectAccessRequestRequest {
  string request_id = 1;
}

message RejectAccessRequestResponse {
  bool success = 1;
  string message = 2;
}

enum AccessRequestStatus {
  PENDING = 0;
  APPROVED = 1;
  REJECTED = 2;
}


message InsurerDashboardStatsResponse {
  int32 total_authorized = 1;
  int32 pending_requests = 2;
  int32 total_patients = 3;
}


message AuthorizedReport {
  string report_id = 1;
  string patient_id = 2;
  string date = 4;
  string expiry = 5;
}

message ListAuthorizedReportsResponse {
  repeated AuthorizedReport reports = 1;
}


message PatientIDRequest {
  string patient_id = 1;
}

message ReportMeta {
  string report_id = 1;
  string clinic_id = 2;
  int64 created_at = 3;
}

message ListReportMetaResponse {
  repeated ReportMeta reports = 1;
}

message ViewAuthorizedReportRequest {
  string report_id = 1;
  string user_id = 2;
}

message ViewAuthorizedReportResponse {
  bool success = 1;
  string result_json = 2;        // å ±å‘Šå…¨æ–‡æˆ–æ ¼å¼åŒ–å…§å®¹
}


message ListMyAccessRequestsResponse {
  bool success = 1;
  repeated AccessRequest requests = 3;
}